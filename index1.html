<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyDrugs | Serviços Farmacêuticos Premium</title>
    <style>
        :root {
            --primary: #1a1a2e;
            --secondary: #16213e;
            --accent: #0f3460;
            --highlight: #00b4d8;
            --text: #e6e6e6;
            --dark: #0d0d0d;
            --success: #2ecc71;
            --warning: #f39c12;
            --error: #e74c3c;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background-color: var(--dark);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .terminal-bar {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            padding: 0.8rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--highlight);
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--highlight);
            text-shadow: 0 0 10px rgba(0, 180, 216, 0.7);
            white-space: nowrap;
        }
        
        .nav-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .nav-links {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .nav-links a {
            color: var(--text);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            position: relative;
            white-space: nowrap;
        }
        
        .nav-links a:hover {
            color: var(--highlight);
        }
        
        .nav-links a::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 1px;
            bottom: -3px;
            left: 0;
            background-color: var(--highlight);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .nav-links a:hover::after {
            transform: scaleX(1);
        }
        
        .auth-section {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 0.5rem 1.2rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 0.8rem;
            border: 1px solid var(--highlight);
            background: transparent;
            color: var(--highlight);
            white-space: nowrap;
        }
        
        .btn:hover {
            background: rgba(0, 180, 216, 0.1);
            box-shadow: 0 0 10px rgba(0, 180, 216, 0.5);
        }
        
        .btn-primary {
            background: var(--highlight);
            color: var(--dark);
            border: none;
            font-weight: bold;
        }
        
        .btn-primary:hover {
            background: transparent;
            color: var(--highlight);
            box-shadow: 0 0 15px rgba(0, 180, 216, 0.7);
        }
        
        .cart-count {
            position: relative;
            display: inline-block;
        }
        
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--error);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }
        
        .main-content {
            padding: 2rem 1rem;
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        .hero {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .hero h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .product-card {
            background: var(--secondary);
            border: 1px solid rgba(0, 180, 216, 0.3);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border-color: var(--highlight);
        }
        
        .product-image {
            height: 200px;
            background: var(--dark);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--highlight);
            font-size: 3rem;
        }
        
        .product-info {
            padding: 1.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .product-name {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--highlight);
        }
        
        .product-description {
            margin-bottom: 1rem;
            font-size: 0.9rem;
            opacity: 0.8;
            flex: 1;
        }
        
        .product-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--highlight);
            margin-bottom: 1rem;
        }
        
        .product-rating {
            color: gold;
            margin-bottom: 1rem;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .modal-content {
            background: var(--primary);
            margin: 2rem auto;
            padding: 1.5rem;
            border: 1px solid var(--highlight);
            border-radius: 8px;
            max-width: 500px;
            width: 100%;
            position: relative;
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text);
        }
        
        .close-btn:hover {
            color: var(--highlight);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--highlight);
        }
        
        .form-control {
            width: 100%;
            padding: 0.8rem;
            background: var(--secondary);
            border: 1px solid var(--accent);
            border-radius: 4px;
            color: var(--text);
            font-family: 'Courier New', monospace;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--highlight);
        }
        
        .error-message {
            color: var(--error);
            margin-top: 0.5rem;
            font-size: 0.8rem;
            display: none;
        }
        
        /* Cart Styles */
        .cart-items {
            margin-top: 1.5rem;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--accent);
        }
        
        .cart-item-info {
            flex: 1;
            margin-right: 1rem;
        }
        
        .cart-item-name {
            font-weight: bold;
            margin-bottom: 0.3rem;
        }
        
        .cart-item-price {
            white-space: nowrap;
            text-align: right;
        }
        
        .remove-item {
            color: var(--error);
            cursor: pointer;
            margin-left: 1rem;
        }
        
        .cart-total {
            text-align: right;
            margin-top: 1.5rem;
            font-size: 1.3rem;
            font-weight: bold;
        }
        
        /* Payment Styles */
        .payment-address {
            background: var(--secondary);
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
            word-break: break-all;
            font-size: 0.9rem;
        }
        
        .status-badge {
            padding: 0.5rem;
            border-radius: 4px;
            text-align: center;
            margin: 1rem 0;
        }
        
        .status-pending {
            background: var(--warning);
            color: var(--dark);
        }
        
        .status-success {
            background: var(--success);
            color: white;
        }
        
        /* Reviews Section */
        .reviews-section {
            margin-top: 3rem;
            padding: 1.5rem;
            background: var(--secondary);
            border-radius: 8px;
        }
        
        .review-form {
            margin-bottom: 2rem;
        }
        
        .review-textarea {
            width: 100%;
            min-height: 100px;
            padding: 1rem;
            background: var(--dark);
            border: 1px solid var(--accent);
            border-radius: 4px;
            color: var(--text);
            font-family: 'Courier New', monospace;
            margin-bottom: 1rem;
        }
        
        .reviews-list {
            margin-top: 1.5rem;
        }
        
        .review-item {
            background: var(--primary);
            padding: 1.2rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            border-left: 3px solid var(--highlight);
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .review-text {
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            white-space: pre-wrap;
        }
        
        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .terminal-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .nav-container {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
            }
            
            .nav-links {
                justify-content: space-around;
                padding: 0.5rem 0;
                border-top: 1px solid rgba(0, 180, 216, 0.2);
                border-bottom: 1px solid rgba(0, 180, 216, 0.2);
                margin: 0.5rem 0;
            }
            
            .auth-section {
                justify-content: center;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            }
            
            .modal-content {
                margin: 1rem auto;
                padding: 1.2rem;
            }
        }
        
        @media (max-width: 480px) {
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <header class="terminal-bar">
        <div class="logo">MYDRUGS</div>
        
        <div class="nav-container">
            <nav class="nav-links">
                <a href="#products">PRODUTOS</a>
                <a href="#reviews">AVALIAÇÕES</a>
                <a href="#security">SEGURANÇA</a>
            </nav>
            
            <div class="auth-section" id="authSection">
                <button id="loginBtn" class="btn">LOGIN</button>
                <button id="registerBtn" class="btn">REGISTRO</button>
                <div class="cart-count">
                    <button id="cartBtn" class="btn">CARRINHO</button>
                    <span id="cartBadge" class="cart-badge" style="display: none;">0</span>
                </div>
            </div>
            
            <div class="auth-section" id="userSection" style="display: none;">
                <span id="usernameDisplay" style="color: var(--highlight); margin-right: 0.5rem;"></span>
                <button id="logoutBtn" class="btn">LOGOUT</button>
                <div class="cart-count">
                    <button id="cartBtnLogged" class="btn">CARRINHO</button>
                    <span id="cartBadgeLogged" class="cart-badge" style="display: none;">0</span>
                </div>
            </div>
        </div>
    </header>
    
    <main class="main-content">
        <section class="hero">
            <h1>PRODUTOS FARMACÊUTICOS PREMIUM</h1>
            <p>Entrega discreta mundial com pagamentos apenas em Bitcoin</p>
        </section>
        
        <section id="products">
            <div class="products-grid" id="productsGrid">
                <!-- Produtos serão carregados aqui -->
            </div>
        </section>
        
        <section class="reviews-section" id="reviews">
            <h2>AVALIAÇÕES DOS CLIENTES</h2>
            
            <div class="review-form" id="reviewForm" style="display: none;">
                <h3>DEIXE SUA AVALIAÇÃO</h3>
                <textarea id="reviewText" class="review-textarea" placeholder="Escreva sua avaliação sobre os produtos e serviços..."></textarea>
                <div style="margin-bottom: 1rem;">
                    <label>Avaliação: </label>
                    <select id="reviewRating" class="form-control" style="width: auto; display: inline-block;">
                        <option value="5">★★★★★</option>
                        <option value="4">★★★★☆</option>
                        <option value="3">★★★☆☆</option>
                        <option value="2">★★☆☆☆</option>
                        <option value="1">★☆☆☆☆</option>
                    </select>
                </div>
                <button id="submitReview" class="btn btn-primary">ENVIAR AVALIAÇÃO</button>
            </div>
            
            <div class="reviews-list" id="reviewsList">
                <!-- Avaliações serão carregadas aqui -->
            </div>
        </section>
        
        <section class="security-section" id="security">
            <h2>PROTOCOLOS DE SEGURANÇA 🔒</h2>
            <div style="margin: 1rem 0;">
                <span class="status-badge" style="display: inline-block; background: var(--accent);">AES-256</span>
                <span class="status-badge" style="display: inline-block; background: var(--accent);">SHA-512</span>
                <span class="status-badge" style="display: inline-block; background: var(--accent);">PGP</span>
            </div>
            <p>Todos os dados são criptografados ponta-a-ponta, incluindo:</p>
            <ul style="margin-top: 0.5rem; padding-left: 1.5rem;">
                <li>Credenciais de usuário (com hash e salt)</li>
                <li>Histórico de transações</li>
                <li>Dados de pagamento</li>
            </ul>
        </section>
    </main>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>ACESSO DO CLIENTE</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginUsername">USUÁRIO</label>
                    <input type="text" id="loginUsername" class="form-control" required>
                    <div id="loginUserError" class="error-message"></div>
                </div>
                <div class="form-group">
                    <label for="loginPassword">SENHA</label>
                    <input type="password" id="loginPassword" class="form-control" required>
                    <div id="loginPassError" class="error-message"></div>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">ACESSAR</button>
            </form>
        </div>
    </div>
    
    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>CRIAR NOVA CONTA</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label for="regUsername">USUÁRIO</label>
                    <input type="text" id="regUsername" class="form-control" required minlength="3">
                    <div id="regUserError" class="error-message"></div>
                </div>
                <div class="form-group">
                    <label for="regPassword">SENHA</label>
                    <input type="password" id="regPassword" class="form-control" required minlength="6">
                    <div id="regPassError" class="error-message"></div>
                </div>
                <div class="form-group">
                    <label for="regConfirm">CONFIRMAR SENHA</label>
                    <input type="password" id="regConfirm" class="form-control" required>
                    <div id="regConfirmError" class="error-message"></div>
                </div>
                <div class="form-group">
                    <label for="regPGP">CHAVE PGP PÚBLICA (OPCIONAL)</label>
                    <textarea id="regPGP" rows="3" class="form-control"></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">CRIAR CONTA</button>
            </form>
        </div>
    </div>
    
    <!-- Cart Modal -->
    <div id="cartModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-btn">&times;</span>
            <h2>SEU CARRINHO</h2>
            <div class="cart-items" id="cartItems">
                <p id="emptyCartMessage">Seu carrinho está vazio</p>
            </div>
            <div class="cart-total">
                <strong>TOTAL: <span id="cartTotal">0</span> BTC</strong>
            </div>
            <button id="checkoutBtn" class="btn btn-primary" style="width: 100%; margin-top: 1rem; display: none;">FINALIZAR COMPRA</button>
        </div>
    </div>
    
    <!-- Payment Modal -->
    <div id="paymentModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-btn">&times;</span>
            <h2>PAGAMENTO COM BITCOIN</h2>
            <p>Envie exatamente <strong id="paymentAmount">0</strong> BTC para:</p>
            <div class="payment-address">
                bc1qfdedkcvzp07f3pyuf7gtzdjz4rugnkdqyv2c97
            </div>
            <div style="text-align: center; margin: 1rem 0;">
                <div style="background: white; padding: 1rem; display: inline-block;">
                    [QR CODE BTC]
                </div>
            </div>
            
            <div style="margin-top: 1.5rem;">
                <div class="status-badge status-pending" id="paymentStatus">
                    AGUARDANDO PAGAMENTO...
                </div>
                <div style="text-align: center; font-size: 0.9rem; margin-top: 0.5rem;">
                    Última verificação: <span id="lastCheck">agora</span>
                </div>
            </div>
            
            <button id="cancelPayment" class="btn" style="width: 100%; margin-top: 1rem;">CANCELAR PEDIDO</button>
        </div>
    </div>
    
    <script>
        // Sistema de Autenticação
        class AuthSystem {
            static users = JSON.parse(localStorage.getItem('mydrugs_users')) || [];
            static currentUser = null;
            
            static init() {
                this.loadSession();
            }
            
            static register(username, password, pgpKey = '') {
                // Validação
                if (this.users.some(u => u.username.toLowerCase() === username.toLowerCase())) {
                    return { success: false, message: 'Nome de usuário já em uso' };
                }
                
                if (password.length < 6) {
                    return { success: false, message: 'A senha deve ter pelo menos 6 caracteres' };
                }
                
                // Criar usuário
                const user = {
                    username,
                    password: this.hashPassword(password),
                    pgpKey,
                    createdAt: new Date().toISOString(),
                    orders: []
                };
                
                this.users.push(user);
                this.saveUsers();
                return { success: true, user };
            }
            
            static login(username, password) {
                const user = this.users.find(u => u.username.toLowerCase() === username.toLowerCase());
                
                if (!user) {
                    return { success: false, message: 'Usuário não encontrado' };
                }
                
                if (user.password !== this.hashPassword(password)) {
                    return { success: false, message: 'Senha incorreta' };
                }
                
                this.currentUser = user;
                this.saveSession();
                return { success: true, user };
            }
            
            static logout() {
                this.currentUser = null;
                this.clearSession();
                return { success: true };
            }
            
            static hashPassword(password) {
                // Simulação de hash - em produção usar PBKDF2 ou bcrypt
                let hash = 5381;
                for (let i = 0; i < password.length; i++) {
                    hash = (hash * 33) ^ password.charCodeAt(i);
                }
                return (hash >>> 0).toString(16);
            }
            
            static saveUsers() {
                localStorage.setItem('mydrugs_users', JSON.stringify(this.users));
            }
            
            static loadSession() {
                const session = JSON.parse(localStorage.getItem('mydrugs_session'));
                if (session) {
                    const user = this.users.find(u => 
                        u.username === session.username && 
                        u.password === session.passwordHash
                    );
                    if (user) {
                        this.currentUser = user;
                        return user;
                    }
                }
                return null;
            }
            
            static saveSession() {
                if (this.currentUser) {
                    localStorage.setItem('mydrugs_session', JSON.stringify({
                        username: this.currentUser.username,
                        passwordHash: this.currentUser.password
                    }));
                }
            }
            
            static clearSession() {
                localStorage.removeItem('mydrugs_session');
            }
        }

        // Sistema de Produtos e Carrinho
        class StoreSystem {
            static products = [
                {
                    id: 1,
                    name: "ECSTASY GOLD",
                    emoji: "💊",
                    description: "Cristais de MDMA premium com 99.9% de pureza, testados em laboratório",
                    price: 0.0012,
                    rating: "★★★★★"
                },
                {
                    id: 2,
                    name: "PSILOCYBIN PRO",
                    emoji: "🍄",
                    description: "Trufas mágicas com potência consistente, seladas a vácuo",
                    price: 0.0018,
                    rating: "★★★★☆"
                },
                {
                    id: 3,
                    name: "HYBRID #42",
                    emoji: "🌿",
                    description: "Strain premium de cannabis, 27% THC, cultivo indoor",
                    price: 0.0006,
                    rating: "★★★★★"
                },
                {
                    id: 4,
                    name: "LAB-GRADE LSD",
                    emoji: "🧪",
                    description: "Blotters de 200μg com molécula Hoffman, verificado em laboratório",
                    price: 0.0004,
                    rating: "★★★★★"
                }
            ];
            
            static cart = [];
            
            static init() {
                this.loadCart();
            }
            
            static addToCart(productId) {
                const product = this.products.find(p => p.id === productId);
                if (!product) return false;
                
                const existingItem = this.cart.find(item => item.id === productId);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    this.cart.push({ ...product, quantity: 1 });
                }
                
                this.saveCart();
                return true;
            }
            
            static removeFromCart(productId) {
                this.cart = this.cart.filter(item => item.id !== productId);
                this.saveCart();
            }
            
            static getCartTotal() {
                return this.cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            }
            
            static getCartItemCount() {
                return this.cart.reduce((count, item) => count + item.quantity, 0);
            }
            
            static saveCart() {
                if (AuthSystem.currentUser) {
                    localStorage.setItem(
                        `mydrugs_cart_${AuthSystem.currentUser.username}`, 
                        JSON.stringify(this.cart)
                    );
                } else {
                    localStorage.setItem('mydrugs_cart_guest', JSON.stringify(this.cart));
                }
            }
            
            static loadCart() {
                let savedCart;
                if (AuthSystem.currentUser) {
                    savedCart = localStorage.getItem(`mydrugs_cart_${AuthSystem.currentUser.username}`);
                } else {
                    savedCart = localStorage.getItem('mydrugs_cart_guest');
                }
                
                this.cart = savedCart ? JSON.parse(savedCart) : [];
            }
            
            static clearCart() {
                this.cart = [];
                this.saveCart();
            }
        }

        // Sistema de Avaliações (sem criptografia)
        class ReviewSystem {
            static reviews = JSON.parse(localStorage.getItem('mydrugs_reviews')) || [];
            
            static submitReview(text, rating, username) {
                if (!text || !rating || !username) return false;
                
                const review = {
                    id: Date.now(),
                    username,
                    date: new Date().toISOString(),
                    text: text, // Texto armazenado sem criptografia
                    rating: parseInt(rating)
                };
                
                this.reviews.push(review);
                this.saveReviews();
                return true;
            }
            
            static getRecentReviews(limit = 5) {
                return [...this.reviews].reverse().slice(0, limit);
            }
            
            static saveReviews() {
                localStorage.setItem('mydrugs_reviews', JSON.stringify(this.reviews));
            }
        }

        // Sistema de Pagamento
        class PaymentSystem {
            static processPayment(amount) {
                return new Promise((resolve) => {
                    // Simular processamento de pagamento
                    setTimeout(() => {
                        resolve({ 
                            success: true, 
                            transactionId: `tx_${Date.now()}`,
                            amount 
                        });
                    }, 3000);
                });
            }
        }

        // Gerenciador de Interface
        class UIManager {
            static init() {
                this.renderProducts();
                this.setupEventListeners();
                this.updateUI();
            }
            
            static updateUI() {
                // Atualizar estado de autenticação
                if (AuthSystem.currentUser) {
                    document.getElementById('authSection').style.display = 'none';
                    document.getElementById('userSection').style.display = 'flex';
                    document.getElementById('usernameDisplay').textContent = AuthSystem.currentUser.username;
                    document.getElementById('reviewForm').style.display = 'block';
                } else {
                    document.getElementById('authSection').style.display = 'flex';
                    document.getElementById('userSection').style.display = 'none';
                    document.getElementById('reviewForm').style.display = 'none';
                }
                
                // Atualizar carrinho
                this.updateCartBadge();
                
                // Carregar avaliações
                this.loadReviews();
            }
            
            static renderProducts() {
                const productsGrid = document.getElementById('productsGrid');
                productsGrid.innerHTML = '';
                
                StoreSystem.products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    productCard.innerHTML = `
                        <div class="product-image">${product.emoji}</div>
                        <div class="product-info">
                            <h3 class="product-name">${product.name}</h3>
                            <p class="product-description">${product.description}</p>
                            <div class="product-rating">${product.rating}</div>
                            <div class="product-price">${product.price.toFixed(6)} BTC</div>
                            <button class="btn btn-primary add-to-cart" data-id="${product.id}" style="width: 100%;">ADICIONAR</button>
                        </div>
                    `;
                    productsGrid.appendChild(productCard);
                });
            }
            
            static updateCartBadge() {
                const count = StoreSystem.getCartItemCount();
                const badge = document.getElementById('cartBadge');
                const badgeLogged = document.getElementById('cartBadgeLogged');
                
                if (count > 0) {
                    badge.textContent = count;
                    badge.style.display = 'flex';
                    badgeLogged.textContent = count;
                    badgeLogged.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                    badgeLogged.style.display = 'none';
                }
            }
            
            static renderCart() {
                const cartItems = document.getElementById('cartItems');
                const emptyMsg = document.getElementById('emptyCartMessage');
                const checkoutBtn = document.getElementById('checkoutBtn');
                
                if (StoreSystem.cart.length === 0) {
                    emptyMsg.style.display = 'block';
                    checkoutBtn.style.display = 'none';
                    cartItems.innerHTML = '<p id="emptyCartMessage">Seu carrinho está vazio</p>';
                    return;
                }
                
                emptyMsg.style.display = 'none';
                checkoutBtn.style.display = 'block';
                
                let itemsHTML = '';
                StoreSystem.cart.forEach(item => {
                    itemsHTML += `
                        <div class="cart-item">
                            <div class="cart-item-info">
                                <div class="cart-item-name">${item.name}</div>
                                <div>${item.price.toFixed(6)} BTC × ${item.quantity}</div>
                            </div>
                            <div class="cart-item-price">
                                ${(item.price * item.quantity).toFixed(6)} BTC
                            </div>
                            <span class="remove-item" data-id="${item.id}">✕</span>
                        </div>
                    `;
                });
                
                cartItems.innerHTML = itemsHTML;
                document.getElementById('cartTotal').textContent = StoreSystem.getCartTotal().toFixed(6);
            }
            
            static loadReviews() {
                const reviewsList = document.getElementById('reviewsList');
                reviewsList.innerHTML = '';
                
                const reviews = ReviewSystem.getRecentReviews();
                
                if (reviews.length === 0) {
                    reviewsList.innerHTML = '<p>Nenhuma avaliação disponível. Seja o primeiro a avaliar!</p>';
                    return;
                }
                
                reviews.forEach(review => {
                    const reviewItem = document.createElement('div');
                    reviewItem.className = 'review-item';
                    
                    const stars = '★'.repeat(review.rating) + '☆'.repeat(5 - review.rating);
                    
                    reviewItem.innerHTML = `
                        <div class="review-header">
                            <span>${review.username}</span>
                            <span>${stars}</span>
                        </div>
                        <div class="review-text">
                            ${review.text} <!-- Texto exibido sem criptografia -->
                        </div>
                        <div style="font-size: 0.8rem; margin-top: 0.5rem; color: var(--highlight);">
                            ${new Date(review.date).toLocaleDateString()}
                        </div>
                    `;
                    
                    reviewsList.appendChild(reviewItem);
                });
            }
            
            static setupEventListeners() {
                // Login
                document.getElementById('loginForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const username = document.getElementById('loginUsername').value.trim();
                    const password = document.getElementById('loginPassword').value.trim();
                    
                    // Reset errors
                    document.getElementById('loginUserError').style.display = 'none';
                    document.getElementById('loginPassError').style.display = 'none';
                    
                    if (!username) {
                        document.getElementById('loginUserError').textContent = 'Por favor, insira um nome de usuário';
                        document.getElementById('loginUserError').style.display = 'block';
                        return;
                    }
                    
                    if (!password) {
                        document.getElementById('loginPassError').textContent = 'Por favor, insira uma senha';
                        document.getElementById('loginPassError').style.display = 'block';
                        return;
                    }
                    
                    const result = AuthSystem.login(username, password);
                    
                    if (result.success) {
                        document.getElementById('loginModal').style.display = 'none';
                        StoreSystem.loadCart();
                        this.updateUI();
                    } else {
                        document.getElementById('loginPassError').textContent = result.message;
                        document.getElementById('loginPassError').style.display = 'block';
                    }
                });
                
                // Registro
                document.getElementById('registerForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const username = document.getElementById('regUsername').value.trim();
                    const password = document.getElementById('regPassword').value.trim();
                    const confirm = document.getElementById('regConfirm').value.trim();
                    const pgpKey = document.getElementById('regPGP').value.trim();
                    
                    // Reset errors
                    document.getElementById('regUserError').style.display = 'none';
                    document.getElementById('regPassError').style.display = 'none';
                    document.getElementById('regConfirmError').style.display = 'none';
                    
                    // Validação
                    let hasError = false;
                    
                    if (username.length < 3) {
                        document.getElementById('regUserError').textContent = 'O nome de usuário deve ter pelo menos 3 caracteres';
                        document.getElementById('regUserError').style.display = 'block';
                        hasError = true;
                    }
                    
                    if (password.length < 6) {
                        document.getElementById('regPassError').textContent = 'A senha deve ter pelo menos 6 caracteres';
                        document.getElementById('regPassError').style.display = 'block';
                        hasError = true;
                    }
                    
                    if (password !== confirm) {
                        document.getElementById('regConfirmError').textContent = 'As senhas não coincidem';
                        document.getElementById('regConfirmError').style.display = 'block';
                        hasError = true;
                    }
                    
                    if (hasError) return;
                    
                    const result = AuthSystem.register(username, password, pgpKey);
                    
                    if (result.success) {
                        document.getElementById('registerModal').style.display = 'none';
                        StoreSystem.loadCart();
                        this.updateUI();
                    } else {
                        document.getElementById('regUserError').textContent = result.message;
                        document.getElementById('regUserError').style.display = 'block';
                    }
                });
                
                // Logout
                document.getElementById('logoutBtn').addEventListener('click', () => {
                    AuthSystem.logout();
                    StoreSystem.loadCart();
                    this.updateUI();
                });
                
                // Carrinho
                document.getElementById('cartBtn').addEventListener('click', () => {
                    this.renderCart();
                    document.getElementById('cartModal').style.display = 'block';
                });
                
                document.getElementById('cartBtnLogged').addEventListener('click', () => {
                    this.renderCart();
                    document.getElementById('cartModal').style.display = 'block';
                });
                
                // Adicionar ao carrinho
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('add-to-cart')) {
                        if (!AuthSystem.currentUser) {
                            alert('Por favor, faça login para adicionar itens ao carrinho');
                            document.getElementById('loginModal').style.display = 'block';
                            return;
                        }
                        
                        const productId = parseInt(e.target.getAttribute('data-id'));
                        if (StoreSystem.addToCart(productId)) {
                            this.updateCartBadge();
                            alert('Produto adicionado ao carrinho!');
                        }
                    }
                    
                    if (e.target.classList.contains('remove-item')) {
                        const productId = parseInt(e.target.getAttribute('data-id'));
                        StoreSystem.removeFromCart(productId);
                        this.updateCartBadge();
                        this.renderCart();
                    }
                });
                
                // Finalizar compra
                document.getElementById('checkoutBtn').addEventListener('click', () => {
                    if (!AuthSystem.currentUser) return;
                    
                    const total = StoreSystem.getCartTotal();
                    document.getElementById('paymentAmount').textContent = total.toFixed(6);
                    document.getElementById('cartModal').style.display = 'none';
                    document.getElementById('paymentModal').style.display = 'block';
                    
                    this.processPayment();
                });
                
                // Cancelar pagamento
                document.getElementById('cancelPayment').addEventListener('click', () => {
                    document.getElementById('paymentModal').style.display = 'none';
                });
                
                // Enviar avaliação
                document.getElementById('submitReview').addEventListener('click', () => {
                    if (!AuthSystem.currentUser) return;
                    
                    const text = document.getElementById('reviewText').value.trim();
                    const rating = document.getElementById('reviewRating').value;
                    
                    if (!text) {
                        alert('Por favor, escreva sua avaliação');
                        return;
                    }
                    
                    if (ReviewSystem.submitReview(text, rating, AuthSystem.currentUser.username)) {
                        document.getElementById('reviewText').value = '';
                        this.loadReviews();
                        alert('Avaliação enviada com sucesso!');
                    }
                });
                
                // Fechar modais
                document.querySelectorAll('.close-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        this.closest('.modal').style.display = 'none';
                    });
                });
                
                // Fechar ao clicar fora
                window.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal')) {
                        e.target.style.display = 'none';
                    }
                });
            }
            
            static async processPayment() {
                const statusElement = document.getElementById('paymentStatus');
                const lastCheckElement = document.getElementById('lastCheck');
                
                statusElement.className = 'status-badge status-pending';
                statusElement.textContent = 'AGUARDANDO PAGAMENTO...';
                
                // Simular verificação de pagamento
                let checks = 0;
                const checkInterval = setInterval(() => {
                    checks++;
                    lastCheckElement.textContent = new Date().toLocaleTimeString();
                    
                    // Simular confirmação após 3 verificações
                    if (checks === 3) {
                        clearInterval(checkInterval);
                        this.completePayment();
                    }
                }, 2000);
            }
            
            static async completePayment() {
                const statusElement = document.getElementById('paymentStatus');
                statusElement.className = 'status-badge status-success';
                statusElement.textContent = 'PAGAMENTO CONFIRMADO!';
                
                // Simular processamento
                setTimeout(() => {
                    // Criar pedido
                    const order = {
                        id: Date.now(),
                        date: new Date().toISOString(),
                        items: [...StoreSystem.cart],
                        total: StoreSystem.getCartTotal(),
                        status: 'completed'
                    };
                    
                    // Adicionar ao histórico do usuário
                    if (AuthSystem.currentUser) {
                        const userIndex = AuthSystem.users.findIndex(
                            u => u.username === AuthSystem.currentUser.username
                        );
                        if (userIndex !== -1) {
                            AuthSystem.users[userIndex].orders.push(order);
                            AuthSystem.saveUsers();
                        }
                    }
                    
                    // Limpar carrinho
                    StoreSystem.clearCart();
                    this.updateCartBadge();
                    
                    // Fechar modal e mostrar confirmação
                    document.getElementById('paymentModal').style.display = 'none';
                    alert(`Pedido #${order.id} realizado com sucesso!\nTotal: ${order.total.toFixed(6)} BTC`);
                }, 2000);
            }
        }

        // Inicialização do sistema
        document.addEventListener('DOMContentLoaded', () => {
            AuthSystem.init();
            StoreSystem.init();
            UIManager.init();
            
            // Botões para abrir modais
            document.getElementById('loginBtn').addEventListener('click', () => {
                document.getElementById('loginModal').style.display = 'block';
                document.getElementById('loginUsername').focus();
            });
            
            document.getElementById('registerBtn').addEventListener('click', () => {
                document.getElementById('registerModal').style.display = 'block';
                document.getElementById('regUsername').focus();
            });
        });
    </script>
</body>
</html>
